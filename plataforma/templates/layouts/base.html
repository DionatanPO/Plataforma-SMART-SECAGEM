<!DOCTYPE html>
{% load static %}
<html lang="pt-br">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Smart Secagem | {% block title %}{% endblock title %}</title>
    <link rel="icon" type="image/x-icon" href="{% static 'dist/img/icone.ico' %}" />

    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <!-- Theme style -->
    <link rel="stylesheet" href="{% static 'dist/css/adminlte.min.css' %}">
    <link rel="stylesheet" href="{% static 'dist/css/style.css' %}">
    <!-- overlayScrollbars -->
    <link rel="stylesheet" href="{% static 'plugins/overlayScrollbars/css/OverlayScrollbars.min.css' %}">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="{% static 'plugins/fontawesome-free/css/all.min.css' %}">
    <style>
    #temperatura-notifications {
        max-height: 600px; /* Defina a altura máxima desejada para o scrollbar */
        overflow-y: auto; /* Adiciona o scrollbar vertical caso o conteúdo exceda a altura máxima */
    }
</style>

    {% block extrastyle %} {% endblock extrastyle %}
</head>

<body class="{% block bodyclass %}{% endblock bodyclass %}">

    <div class="wrapper">

        {% block preloader %}
        <!-- Preloader -->
        <div class="preloader flex-column justify-content-center align-items-center">
            <img class="animation__shake" src="{% static 'dist/img/logo.png' %}" width="90">
        </div>
        {% endblock preloader %}

        {% block header %}
        {% include 'includes/navigation-light.html' %}
        {% endblock header %}

        {% block sidebar %}
        {% include 'includes/sidebar.html' %}
        {% endblock sidebar %}

        {% block content %}{% endblock content %}

        {% block footer %}
        {% include 'includes/footer_plataforma.html' %}
        {% endblock footer %}

        {% block control_sidebar %}

        <!-- Control Sidebar -->
        <aside class="control-sidebar control-sidebar-dark">
            <!-- Control sidebar content goes here -->
        </aside>
        <!-- /.control-sidebar -->

        {% endblock control_sidebar %}

    </div>

    {% include 'includes/scripts.html' %}
    <script>
        // Variável global para armazenar a conexão WebSocket
        let socket = null;

        // Função para conectar WebSocket
        function connectWebSocket() {
            if (!socket || socket.readyState === WebSocket.CLOSED) {
                socket = new WebSocket('ws://127.0.0.1:8000/ws/alertas/'); // Substitua pelo seu endpoint WebSocket

                socket.onopen = function (event) {
                    console.log('Conexão WebSocket aberta');
                };

                socket.onmessage = function (e) {
                    const data = JSON.parse(e.data);
                    // Chamada para mostrar a notificação
                    updateTemperaturaNotifications(data.titulo, data.descricao, data.time); // Adicione o título aqui
                };
            }
        }

        // Função para atualizar o conteúdo do elemento na barra de navegação com as notificações
        function updateTemperaturaNotifications(titulo, descricao, time) {
            const notificationsList = document.getElementById('temperatura-notifications');

            // Cria um elemento de notificação para a nova temperatura
            const notificationItem = document.createElement('li');
            notificationItem.classList.add('dropdown-item');
            notificationItem.style.whiteSpace = 'normal'; // Permite que o texto quebre em várias linhas

            // Adiciona o título e a descrição ao elemento de notificação
            notificationItem.innerHTML = `<strong>${titulo}</strong><br>${descricao}<br><strong> Data ${time}</strong> `;
            notificationsList.appendChild(notificationItem);

            // Atualiza o contador de notificações
            const notificationCount = document.getElementById('notification-count');
            notificationCount.innerText = notificationsList.children.length;
        }

        // Evento chamado quando a página é carregada
        window.onload = function () {
            connectWebSocket();
        };



    </script>
    {% block extra_scripts %}{% endblock extra_scripts %}


</body>

</html>